repositories {
	mavenCentral()
	maven { url "https://maven.restlet.com/" }
	maven { url "https://oss.sonatype.org/content/repositories/snapshots/" }
}

apply plugin: "groovy"

configurations {
	runtime {
		transitive = true
	}
}

dependencies {
	compile gradleApi()
	compile localGroovy()
	runtime "net.sf.saxon:Saxon-HE:9.6.0-7"
	runtime 'com.xmlcalabash:xmlcalabash:1.1.9-96'
	runtime "org.apache.xmlgraphics:fop:2.0"
}

group = "com.github.rwdalpe"
version = "0.0.1"
libsDirName = "dist"

task getXsltAssets() {
	ext.lib = file("${buildDir}/xslt-assets/assets")

	if(!ext.lib.exists()) {
		ext.lib.mkdir()
	}

	doFirst {
		ant.get(dest: ext.lib, src: "${libJingUrl}", skipexisting: true)
		ant.unzip(dest: ext.lib, src: "${ext.lib}/${libJingZip}", overwrite: false)
		ant.get(dest: ext.lib, src: "${libXslt2StylesheetsUrl}", skipexisting: true)
		ant.unzip(dest: ext.lib, src: "${ext.lib}/${libXslt2StylesheetsZip}", overwrite: false)
		ant.get(dest: ext.lib, src: "${libXslt2StylesheetsExtensionsUrl}", skipexisting: true)
		ant.unzip(dest: ext.lib, src: "${ext.lib}/${libXslt2StylesheetsExtensionsZip}", overwrite: false)
		ant.get(dest: ext.lib, src: "${libDocbookRpgExtensionsUrl}", skipexisting: true)
		ant.unzip(dest: "${lib}/${libDocbookRpgExtensions}", src: "${ext.lib}/${libDocbookRpgExtensionsZip}", overwrite: false)
		ant.get(dest: ext.lib, src: "${libXslt2StylesheetsRpgExtensionsUrl}", skipexisting: true)
		ant.unzip(dest: "${ext.lib}/${libXslt2StylesheetsRpgExtensions}", src: "${ext.lib}/${libXslt2StylesheetsRpgExtensionsZip}", overwrite: false)
		ant.get(dest: ext.lib, src: "${libXslt1StylesheetsRpgExtensionsUrl}", skipexisting: true)
		ant.unzip(dest: "${ext.lib}/${libXslt1StylesheetsRpgExtensions}", src: "${ext.lib}/${libXslt1StylesheetsRpgExtensionsZip}", overwrite: false)
	}
}

task zipAssets(type: Zip) {
	from "plugin/src/main/resources/assets"
	from tasks.getXsltAssets.lib
	into "docbook-build-assets-${version}"
	archiveName "docbook-build-assets-${version}.zip"
	destinationDir = libsDir
}

sourceSets {
	main {
		java {
			srcDirs = ['plugin/src/main/java']
		}
		resources {
			srcDirs = [tasks.getXsltAssets.lib, 'plugin/src/main/resources']
		}
	}
}

artifacts {
	archives jar
	archives zipAssets
}